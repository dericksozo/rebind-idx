# Rebind × SIM IDX — Minimal Watchlist PoC

This project demonstrates an end-to-end SIM IDX application that filters ERC-20 `Transfer` events on **Base Sepolia (chain ID 84532)** using an on-chain watchlist registry. When a watched address appears as either the sender or recipient of a transfer, the listener emits a `RebindTransfer` event that becomes queryable through the default Postgres sink and the included API route.

## Components

### 1. Watchlist Registry (on-chain)

`listeners/src/watchlist/WatchlistRegistry.sol` contains a minimal owner-controlled registry contract. The owner can add or remove wallets via `setWatched(address wallet, bool watched)`, and off-chain components query membership with `isWatched(address wallet) -> bool`.

To deploy to Base Sepolia with Foundry:

1. Ensure you have a funded deployer on Base Sepolia.
2. From the `listeners` directory run a script similar to:
   ```sh
   forge create src/watchlist/WatchlistRegistry.sol:WatchlistRegistry \
     --rpc-url https://sepolia.base.org \
     --constructor-args <OWNER_ADDRESS> \
     --private-key <DEPLOYER_PRIVATE_KEY>
   ```
3. Copy the deployed registry address and update `REGISTRY` in `listeners/src/RebindERC20Listener.sol` before rebuilding the app.

> **Note:** The repository ships with a zero address placeholder for `REGISTRY`. Replace it with the actual Base Sepolia deployment address before running the listener in production.

### 2. SIM IDX Listener (off-chain)

`listeners/src/RebindERC20Listener.sol` implements the generated `ERC20$OnTransferEvent` interface. For every ERC-20 `Transfer` log observed on Base Sepolia, it checks the watchlist registry and emits a `RebindTransfer` event when the sender or recipient is watched.

`listeners/src/Main.sol` registers this listener ABI-wide on Base Sepolia using the generated ERC-20 ABI bindings.

### 3. API Surface

`apis/src/index.ts` exposes a minimal authenticated endpoint that returns the latest rows from the `rebind_transfer` table generated by the listener. This is enough to validate the “add address on chain → qualifying transfer appears in the table” workflow.

## Building & Evaluating

1. Generate bindings after adding or editing ABIs:
   ```sh
   sim abi add abis/ERC20.json
   ```
2. Build the listener bytecode and generated artifacts:
   ```sh
   sim build
   ```
3. Evaluate the listener against historical data:
   ```sh
   sim listeners evaluate --chain-id 84532 --start-block <BLOCK_WITH_ERC20_TRANSFERS>
   ```
4. Deploy the SIM IDX app once satisfied:
   ```sh
   sim deploy
   ```

After deployment, connect to the provisioned Postgres instance to query `rebind_transfer` and confirm that only transfers involving watched addresses are stored.
